Tags: #backend #jpa
Created: 2022-10-29 16:10
References: https://www.baeldung.com/jpa-entities

# JPA Entities

## Defining entities
In order to define an entity in [[JPA]], you can just use the `@Entity` annotation on the class. optionally, you can also change the name of the entity with the `name = ...` property. **Entity classes must not be declared final.**

You can specify the id of an entity with the `@Id` annotation. You can control how this id is generated by using the `@GeneratedValue(strategy = ...)` annotation with one of these values of `GenerationType`:
- `AUTO`
- `TABLE`
- `SEQUENCE`
- `IDENTITY`

You can control the table with the `@Table` annotation on the class. This annotation has some properties that you can use: `name = ...` for the name of the table and `schema = ...` for the name of the schema.

It is possible to configure the column that corresponds to a field by annotating that field with `@Column`, which has a bunch of fields:
- `name = ...` - name of the table column
- `length = ...` - length of the column
- `nullable = ...` - whether the column is nullable or not
- `unique = ...` - whether column is unique

It's possible to make a field **non-persistent** by using the `@Transient` annotaiton on the field that you want to not persist.

If you want to save a date to the database, you can use the `@Temporal(TemporalType.DATE)` annotaiton on a `Date` field.

For enums, you can save them with the enum's string identifier by annotating the enum field with `@Enumerated(EnumType.STRING)`. If you don't annotate the enum with this, it's going to be persisted with its **ordinal value**.

## Entity lifecycle events
The available lifecycle events are
- `@PrePersist`
- `@PostPersist`
- `@PerRemove`
- `@PostRemove`
- `@PreUpdate`
- `@PostUpdate`
- `@PostLoad`

There are two ways to add lifecycle event handlers:
1. You can annotate some methods in the entity class with one of those annotations to make them handle that specific lifecycle event.
2. You can annotate the methods of a completely separate class (`Handler` in this example) and the annotate the entity class with `@EntityListeners(Handler.class)`.

## Default column values
By default, all columns are nullable. If you want to make them non-nullable and give them a default value when created with a null value, you can do this:

```java
@Entity
public class User {
    @Id
    Long id;

    @Column(columnDefinition = "varchar(255) default 'John Snow'")
    private String name;

    @Column(columnDefinition = "integer default 25")
    private Integer age;

    @Column(columnDefinition = "boolean default false")
    private Boolean locked;
}
```

## @Basic annotation
This annotation is applied to the types that can be **mapped dirrectly to the database column type**: primitive types and their wrappers.

This annotation is applied automatically and has its default values. It can be used to modify the default values:
- `optional = ...` - whether the field allows *null*
- `fetch = FetchType. ...` - how field should be fetched (eagerly or lazily)