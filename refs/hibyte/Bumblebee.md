 Tags: #reference 
Created: 2022-09-02 12:09

# Bumblebee
## Description
Features of Bumblebee (features that can be accessed via a [[RESTful API]]):
- convert between different multimedia file formats
- adjust resolution of an image/video
- generate meta information of a file
- generate thumbnail images of files

## Data management in the file system
Bumblebee does not use any kind of database, instead it uses its own file system to keep track of the generated files, which can be found at `/var/bumblebee`.

When you upload a file to Bumblebee, it puts the file in its own difectory which will have a unique name generated by Bumblebee. In this folder, the original file is stored with the name `file` and is considered the **source file** that can then be transformed on demand.

In case the user want to transform the file, a new `submedia` sub-directory where new entries will be generated for each transformation requested.

### Example
1. User uploads a file
2. Bumblebee generates a unique identifier (`56a1de2a-c6d2-11eb-b8bc-0242ac130003`) and sotres file at path `/var/bumblebee/56a1de2a-c6d2-11eb-b8bc-0242ac130003/file`
3. User requests a transformation to the file
4. Bumblebee generates the transformed media at path `/var/bumblebee/56a1de2a-c6d2-11eb-b8bc- 0242ac130003/submedia/c6442d2e-c6d6-11eb-b8bc-0242ac130003/file`
5. User can access any original/transformed file via the [[API]]

```
/var/bumblebee/
	56a1de2a-c6d2-11eb-b8bc-0242ac130003/
		file
		submedia/
			333ce276-c6d8-11eb-b8bc-0242ac130003/file
			38f8b7ee-c6d8-11eb-b8bc-0242ac130003/file
```

## API
- `GET {base_URL}/api` - Offers information about the currently deployed Bumblebee version
- `POST {base_URL}/api/media` - Upload file that will be transformed later. Location of the uploaded file returned at `Location Header`
- `GET {base_URL}/api/medium/{medium_UUID}` - Get information about source file (UUID, content type, upload time, ...)
- `DELETE {base_URL}/api/medium/{medium_UUID}` - Delete dource file and all its generated submedia
- `GET {base_URL}/api/media/metainfo` - Used for generating meta information about file sent
- `GET {base_URL}/api/media/thumbnail/allowedformats` - Used to receive allowed formats for thumbnails generation
- `POST {base_URL}/api/medium/{medium_UUID}/submedia` - Main endpoint used for transforming files. Information about the kind of transformation is in the body. Location of transformed file is returned in *Location Header*.

Example body (*PDF to image*):
```json
{
	"transformer": "image",
	"transformerParameter": {
		"format": "png",
		"sizeX": 300,
		"page": 1
	}
}
```

- `GET {base_URL}/api/medium/{mediumUUID}/submedium/{submediumUUID}` - Used for retrieving information on a transgormed file (width, height, creation data, ...)
- `GET {base_URL}/api/medium/{mediumUUID}/submedium/{submediumUUID}/download` - Download resulted file from Bumblebee

## WebSocket
The URL of the [[WebSocket]] is `wss://{origin}/ws/events`. Bumblebee sends events regarding the status of transforming a medium after a `POST` to the transformation endpoint after subscribing to that event type.

The initial message (with which you subscribe to the submedium transformation) looks like this

```json
{
	"messageType": "subscription",
	"subscriptions": [{
		"subMediumUid": subMediumUUID,
		"channel": "submediumchanged"
	}]
}
```

When the submedium is done transforming a message like this is sent on the websocket

```json
{
	"event": {
		"channel": "submediumchanged",
		"source": "162f8b34-3d29-43e3-9d2a-0cc6fa0d8157",
		"subMedium": "3dd4de54-2122-458f-bc34-d8e5f8490c5a",
		"state": "READY",
		"percentageState": 100,
		"warningMessage": [],
		"errorMessage": ""
	},
	"messageType": "event"
}
```

## Resources
Bumblebee Walkthrough