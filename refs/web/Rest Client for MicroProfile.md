Tags: #reference 
Created: 2022-09-03 22:09

# [[MicroProfile Rest Client]]
[[MicroProfile]] type safe rest clients are defined as [[Java]] interfaces.


## Sample
All base in [[HTTP]] methods and parameter types are supported. In case you only need the body of the response, you can directly specify the return type as the POJO you need, otherwise make it be `Response`.

Specify the outbound media (MIME) type with `@Consumes` and expected media types of response with `@Produces`.

```java
@Path("/users")
@Produces("application/json")
@Consumes("application/json")
public interface UsersClient {
    @OPTIONS
    Response options();

    @HEAD
    Response head();

    @GET
    List<User> getUsers();

    @GET
    @Path("/{userId}")
    User getUser(@PathParam("userId") String userId);

    @HEAD
    @Path("/{userId}")
    Response headUser(@PathParam("userId") String userId);

    @POST
    Response createUser(@HeaderParam("Authorization") String authorization,
                                                      User user);

    @PUT
    @Path("/{userId}")
    Response updateUser(@BeanParam PutUser putUser, User user);

    @DELETE
    @Path("/{userId}")
    Response deleteUser(@CookieParam("AuthToken") String authorization,
                        @PathParam("userId") String userId);
}

public class PutUser {
    @HeaderParam("Authorization")
    private String authorization;
    @PathParam("userId")
    private String userId;
    // getters, setters, constructors omitted
}
```

## Additional client headers
It is possible to make a request send headers without specifying those headers as params with `@HeaderParam`. This can be done with the `@ClientHeaderParam` annotation, which can specify the key and value of the header. The value can either be hardcoded or be generated by a method.

```java
@Path("/somePath")
public interface MyClient {

    @POST
    @ClientHeaderParam(name="X-Http-Method-Override", value="PUT")
    Response sentPUTviaPOST(MyEntity entity);

    @POST
    @ClientHeaderParam(name="X-Request-ID", value="{generateRequestId}")
    Response postWithRequestId(MyEntity entity);

    @GET
    @ClientHeaderParam(name="CustomHeader",
                       value="{some.pkg.MyHeaderGenerator.generateCustomHeader}",
                       required=false)
    Response getWithoutCustomHeader();

    default String generateRequestId() {
        return UUID.randomUUID().toString();
    }
}

public class MyHeaderGenerator {
    public static String generateCustomHeader(String headerName) {
        if ("CustomHeader".equals(headerName)) {
            throw UnsupportedOperationException();
        }
        return "SomeValue";
    }
}

@Path("/someOtherPath")
@ClientHeaderParam(name="CustomHeader", value="value1")
@ClientHeaderParam(name="CustomHeader", value="{generateCustomHeader}")
// will throw a RestClientDefinitionException at build time
public interface MyInvalidClient {
...
}
```

## Programmatic lookup
Type safe rest clients also support programmatic lookup (besides [[CDI]]).

```java
public class SomeService {
   public Response doWorkAgainstApi(URI apiUri, ApiModel apiModel) {
       RemoteApi remoteApi = RestClientBuilder.newBuilder()
            .baseUri(apiUri)
            .build(RemoteApi.class);
       return remoteApi.execute(apiModel);
   }
}
```

The `baseUri` is the URL of the service and the parameter `build` takes is an interface that defiles the [[API]] methods to be invoked.

## Client provider registration
The rest client builder extends the `Configurable` interface from [[JAX-RS]], which means that the users can specify custom providers while building. More details in the [[JAX-RS Client]] spec.

## MicroProfile rest client CDI support
Rest client interfaces can be injected where you need to use them. The thing is that you must also annotate the place where you inject it with `@RestClient` as well.

```java
@RegisterRestClient(baseUri="http://someHost/someContextRoot")
public interface MyServiceClient {
    @GET
    @Path("/greet")
    Response greet();
}
```

```java
@ApplicationScoped
public class MyService {
    @Inject
    @RestClient
    private MyServiceClient client;
}
```

#unfinished

## Resources
https://download.eclipse.org/microprofile/microprofile-rest-client-2.0/microprofile-rest-client-spec-2.0.html